<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.22.1" />
  <meta name="author" content="Bruna Wundervald">
  <meta name="description" content="Statistician">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/atom-one-light.min.css">
    
  
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  
  <link rel="stylesheet" href="/css/blue.css">
  

  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Bruna Wundervald">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Bruna Wundervald">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="/post/2017-06-25-vagalumer/">

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Montserrat:300,400">
  

<title>Aplicações simples do pacote vagalumeR - Bruna Wundervald</title>
<meta property="og:title" content="Aplicações simples do pacote vagalumeR - Bruna Wundervald">
<meta property="og:type" content="article">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="http://xvrdm.github.io/images/" >
  
  

<meta property="description" content="Article posted by [Bruna Wundervald], on Sunday, June 25nd, 2017">
<meta property="og:description" content="Article posted by [Bruna Wundervald], on Sunday, June 25nd, 2017">


<meta name="twitter:creator" content="">
<meta name="twitter:site" content="">

  <title>Aplicações simples do pacote vagalumeR | Bruna Wundervald</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Bruna Wundervald</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#packages">
            
            <span>R Packages</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#talks">
            
            <span>Talks &amp; Workshops</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/docs/curriculum_vitae.pdf">
            
            <span>Curriculum Vitae</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
          </a>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  

  <div class="article-container">
    <h1 itemprop="name">Aplicações simples do pacote vagalumeR</h1>
    

<div class="article-metadata">


  <span class="article-date">
    <time datetime="2017-06-25 00:00:00 &#43;0000 &#43;0000" itemprop="datePublished">
      Sun, Jun 25, 2017
    </time>
  </span>
  

  @map[content:Page(&#34;Aplicações simples do pacote vagalumeR&#34;) is_list:0]
  </span>
  

  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/an%c3%a1lises">análises</a
    >, 
    
    <a href="/categories/r">r</a
    >
    
  </span>
  
  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="/tags/musica">musica</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2017-06-25-vagalumer%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Aplica%c3%a7%c3%b5es%20simples%20do%20pacote%20vagalumeR&amp;url=%2fpost%2f2017-06-25-vagalumer%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2017-06-25-vagalumer%2f&amp;title=Aplica%c3%a7%c3%b5es%20simples%20do%20pacote%20vagalumeR"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2017-06-25-vagalumer%2f&amp;title=Aplica%c3%a7%c3%b5es%20simples%20do%20pacote%20vagalumeR"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Aplica%c3%a7%c3%b5es%20simples%20do%20pacote%20vagalumeR&amp;body=%2fpost%2f2017-06-25-vagalumer%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      <p>O site <a href="https://www.vagalume.com.br" class="uri">https://www.vagalume.com.br</a> é um lugar aonde podemos obter informações sobre músicas, com foco nas letras e traduções delas. Este site possui uma API, que pode ser acessada no <code>R</code> através do pacote <a href="https://github.com/brunaw/vagalumeR">vagalumeR</a>. Aqui, demonstra-se algumas funcionalidades do pacote, sendo uma das mais interessantes delas a análise das letras das músicas.</p>
<pre class="r"><code># Carregamento de pacotes
library(vagalumeR)
library(tidyverse)
library(tm)
library(lattice)
library(lexiconPT)
library(latticeExtra)
library(wordcloud)
library(networkD3)

packageVersion(&quot;vagalumeR&quot;)</code></pre>
<p>Para acessar a API, é preciso que o usuário possua um <code>token</code>, que pode ser obtido no endereço: <a href="https://auth.vagalume.com.br/settings/api/" class="uri">https://auth.vagalume.com.br/settings/api/</a></p>
<pre class="r"><code>key &lt;- &quot;insira seu token&quot;</code></pre>
<pre class="r"><code># Seleção de algum artista
artist &lt;- &quot;chico-buarque&quot;

# Informações sobre o artista
(info &lt;- artistInfo(artist))

# Discografia do artista
disc &lt;- discography(artist)
head(disc, 10)

# Contagem de discos por ano
xtabs(~date, disc)

# Artistas relacionados
(rel &lt;- relatedInfo(artist))[,4]

# Busca de letras de músicas do artista
song &lt;- songNames(artist)
let &lt;- plyr::ldply(map(song$song.id[1:10], lyrics, type = &quot;id&quot;, key = key),
             data.frame)

str(let)

#------------------------------------------------------------------# Frequência de Palavras
#------------------------------------------------------------------
# Cria o Corpus e limpa 
cps &lt;- VCorpus(VectorSource(let$text),
                 readerControl = list(language = &quot;pt&quot;))
cps &lt;- tm_map(cps, FUN = content_transformer(tolower))
cps &lt;- tm_map(cps, FUN = removePunctuation)
cps &lt;- tm_map(cps, FUN = removeNumbers)
cps &lt;- tm_map(cps, FUN = stripWhitespace)
cps &lt;- tm_map(cps,
                FUN = removeWords,
                words = stopwords(&quot;portuguese&quot;))
cps &lt;- tm_map(cps,
                FUN = removeWords,
                words = &quot;\t&quot;)

# Cria a matriz de documentos e termos
dtm &lt;- DocumentTermMatrix(cps)

# Características da dtm
inspect(dtm)

# Termos com uma certa frequência miníma
tms &lt;- findFreqTerms(dtm, lowfreq = 3)
str(tms)

# Termos que são associados
assoc &lt;- findAssocs(dtm, terms = tms, corlimit = 0.9)
b &lt;- data.frame(pal = &quot;amor&quot;, assoc = names(assoc$amor))

# Visualização de associação entre palavras
simpleNetwork(b,
              opacity = 0.8, 
              linkColour= &quot;violet&quot;, 
              nodeColour=&quot;tomato&quot;, 
              zoom=TRUE, fontSize = 16,
              linkDistance = 70)

# Contagem das palavras
frq &lt;- slam::colapply_simple_triplet_matrix(dtm, FUN = sum)
frq &lt;- sort(frq, decreasing = TRUE)

# Gráfico da contagem das 30 palavras mais frequentes
barchart(head(frq, n = 30), xlim = c(0, NA),
         col =  &quot;lightsalmon&quot;, 
         xlab = &quot;Frequência&quot;,
         ylab = &quot;Palavras&quot;,
         main = &quot;Paravras em músicas do Chico Buarque&quot;,
         strip = strip.custom(bg = &quot;white&quot;))

# O mesmo resultado visto em nuvem
wordcloud(cps,
          family = &quot;serif&quot;, 
          min.freq = 3,
          max.words = 30,
          colors = brewer.pal(7, &quot;Paired&quot;))

#------------------------------------------------------------------
# Atribuição de Polaridades
#------------------------------------------------------------------

# Dicionário de sentimentos do pacote lexiconPT
dic &lt;- lexiconPT::oplexicon_v3.0
str(dic)

# Intersecção entre termos das músicas e os que estão
# no dicionário
inter &lt;- intersect(x = Terms(dtm),
                   y = dic$term)
length(inter)

# Traz as polaridades para as palavras das músicas
lex &lt;- merge(x = data.frame(term = inter,
                            stringsAsFactors = FALSE),
             y = dic,
             sort = FALSE)
head(lex, 10)

# Tranzforma a dtm em matriz ordinária
m &lt;- as.matrix(dtm)
m &lt;- m[, lex$term]

# Somas por linhas da matriz
rtot &lt;- rowSums(m)

# &quot;Cargas&quot; de cada música
(carga &lt;- (m %*% lex$polarity)/rtot)

# Soma de polaridades por música
m %*% cbind(lex$polarity)

# Função que traz as proporções de cada polaridade por música
pp &lt;- function(song){
  
  cps &lt;- VCorpus(VectorSource(song),
                 readerControl = list(language = &quot;pt&quot;))
  cps &lt;- tm_map(cps, FUN = content_transformer(tolower))
  cps &lt;- tm_map(cps, FUN = removePunctuation)
  cps &lt;- tm_map(cps, FUN = removeNumbers)
  cps &lt;- tm_map(cps, FUN = stripWhitespace)
  cps &lt;- tm_map(cps,
                FUN = removeWords,
                words = stopwords(&quot;portuguese&quot;))
  cps &lt;- tm_map(cps,
                FUN = removeWords,
                words = &quot;\t&quot;)
  
  dtm &lt;- DocumentTermMatrix(cps)
  
  inter &lt;- intersect(x = Terms(dtm),
                     y = dic$term)
  
  lex &lt;- merge(x = data.frame(term = inter,
                              stringsAsFactors = FALSE),
               y = dic,
               sort = FALSE)
  
  pp &lt;- c(prop.table(xtabs(~polarity, lex)))
  
  return(pp)  
}
# Porcentagens de cada polaridade por música
(pcs &lt;- plyr::ldply(map(let$text, pp), matrix, ncol = 3))
names(pcs) &lt;- c(&quot;neg&quot;, &quot;neutro&quot;, &quot;pos&quot;)

# Curva da distribuição acumulada dos sentimentos
ecdfplot(~pos+neg+neutro, pcs, 
         col = c(&quot;tomato&quot;, &quot;turquoise&quot;, &quot;orange&quot;),
         key = list(columns = 1,
                    corner = c(0.05, 0.9),
                    lines = list(col = c(&quot;tomato&quot;, &quot;turquoise&quot;,
                                         &quot;orange&quot;)),
                                 text = list(c(&quot;neg&quot;, &quot;neutro&quot;,
                                               &quot;pos&quot;))))</code></pre>

    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    

    
    <li class="next"><a href="/post/2018-04-25-chorrrds/">chorrrds: Analisando acordes de músicas brasileiras <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 Bruna Wundervald &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="/js/hugo-academic.js"></script>
    

    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/r.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/yaml.min.js"></script>
      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

