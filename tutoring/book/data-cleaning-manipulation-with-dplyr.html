<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Data cleaning &amp; manipulation with dplyr | Topics in data analytics</title>
  <meta name="description" content="4 Data cleaning &amp; manipulation with dplyr | Topics in data analytics" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Data cleaning &amp; manipulation with dplyr | Topics in data analytics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Data cleaning &amp; manipulation with dplyr | Topics in data analytics" />
  
  
  

<meta name="author" content="Bruna Wundervald" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reading-data.html"/>
<link rel="next" href="plotting-data-with-ggplot2.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Getting familiar with R &amp; RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#projects"><i class="fa fa-check"></i><b>1.1</b> Projects</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-tidyverse.html"><a href="the-tidyverse.html"><i class="fa fa-check"></i><b>2</b> The <code>tidyverse</code></a><ul>
<li class="chapter" data-level="2.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#the-pipe-operator"><i class="fa fa-check"></i><b>2.1</b> The <code>pipe</code> operator</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reading-data.html"><a href="reading-data.html"><i class="fa fa-check"></i><b>3</b> Reading data</a><ul>
<li class="chapter" data-level="3.1" data-path="reading-data.html"><a href="reading-data.html#the-data-is-available-at-etc"><i class="fa fa-check"></i><b>3.1</b> the data is available at [etc]</a></li>
<li class="chapter" data-level="3.2" data-path="reading-data.html"><a href="reading-data.html#reading-.xlsx-files"><i class="fa fa-check"></i><b>3.2</b> Reading .xlsx files</a></li>
<li class="chapter" data-level="3.3" data-path="reading-data.html"><a href="reading-data.html#reading-.csv-files"><i class="fa fa-check"></i><b>3.3</b> Reading .csv files</a></li>
<li class="chapter" data-level="3.4" data-path="reading-data.html"><a href="reading-data.html#reading-.txt-files"><i class="fa fa-check"></i><b>3.4</b> Reading .txt files</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-cleaning-manipulation-with-dplyr.html"><a href="data-cleaning-manipulation-with-dplyr.html"><i class="fa fa-check"></i><b>4</b> Data cleaning &amp; manipulation with <code>dplyr</code></a><ul>
<li class="chapter" data-level="4.1" data-path="data-cleaning-manipulation-with-dplyr.html"><a href="data-cleaning-manipulation-with-dplyr.html#manipulation"><i class="fa fa-check"></i><b>4.1</b> Manipulation</a></li>
<li class="chapter" data-level="4.2" data-path="data-cleaning-manipulation-with-dplyr.html"><a href="data-cleaning-manipulation-with-dplyr.html#cleaning"><i class="fa fa-check"></i><b>4.2</b> Cleaning</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="plotting-data-with-ggplot2.html"><a href="plotting-data-with-ggplot2.html"><i class="fa fa-check"></i><b>5</b> Plotting data with ggplot2</a></li>
<li class="chapter" data-level="6" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>6</b> Functional Programming</a><ul>
<li class="chapter" data-level="6.1" data-path="functional-programming.html"><a href="functional-programming.html#modelling"><i class="fa fa-check"></i><b>6.1</b> Modelling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>7</b> Time Series</a></li>
<li class="chapter" data-level="8" data-path="text-mining.html"><a href="text-mining.html"><i class="fa fa-check"></i><b>8</b> Text Mining</a></li>
<li class="chapter" data-level="9" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>9</b> <code>R markdown</code></a></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Topics in data analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-cleaning-manipulation-with-dplyr" class="section level1">
<h1><span class="header-section-number">4</span> Data cleaning &amp; manipulation with <code>dplyr</code></h1>
<p>The <code>dplyr</code> package is arguably the most important/useful one of
the <code>tidyverse</code> group of packages. It provides us with the
“Grammar of Manipulation” that make the most common data manipulation
tasks easy &amp; consistently written.
The term “Grammar” comes from the fact that
the <code>tidyverse</code> functions, in general, are built to work as “verbs”
in a sentence.</p>
<div id="manipulation" class="section level2">
<h2><span class="header-section-number">4.1</span> Manipulation</h2>
<p>The core functions of the <code>dplyr</code> are:</p>
<ul>
<li><code>mutate()</code>: adding and changing variables</li>
<li><code>select()</code>: pick or drop variables</li>
<li><code>filter()</code>: filter the data according to some defined rule</li>
<li><code>summarise</code>: reduces the data to a single value (such as the mean, maximum and minimum, etc)</li>
<li><code>arrange()</code>: ordering data</li>
<li><code>group_by()</code>: perform the above operations <em>taking into account</em>
one or more grouping variables</li>
</ul>
<p>These functions, again, comprise basically the main data manipulation
tasks we always end up doing when dealing with a new dataset. In
the following, we have a few examples of the functions in action:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># Finding summary measures of the package weight </span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">mm3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(Weight),</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">            <span class="dt">sd_weight =</span> <span class="kw">sd</span>(Weight)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lb_mean =</span> mean_weight <span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>sd_weight, </a>
<a class="sourceLine" id="cb12-6" data-line-number="6">         <span class="dt">ub_mean =</span> mean_weight <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>sd_weight)</a></code></pre></div>
<pre><code># A tibble: 1 x 4
  mean_weight sd_weight lb_mean ub_mean
        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1        49.2      1.52    47.7    50.7</code></pre>
<p>If the advertised net weight per bag is 47.9 grams, can we easily
test if the data agrees with that?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">mm3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(Weight),</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">              <span class="dt">sd_weight =</span> <span class="kw">sd</span>(Weight), </a>
<a class="sourceLine" id="cb14-4" data-line-number="4">              </a>
<a class="sourceLine" id="cb14-5" data-line-number="5">              <span class="co"># We can calculate the p-value of a t-test for the </span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6">              <span class="co"># mean being equal to 47.9 and save it as a </span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7">              <span class="co"># summary variable:</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8">              <span class="dt">p.value =</span> <span class="kw">t.test</span>(Weight, <span class="dt">mu =</span> <span class="fl">47.9</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">              ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="st">  </span><span class="co"># Now, is this p-value lower than 0.05 (95% level of significance)?</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">is_mean_equal =</span> <span class="kw">ifelse</span>(p.value <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>, </a>
<a class="sourceLine" id="cb14-12" data-line-number="12">                                <span class="st">&quot;Evidence against&quot;</span>, </a>
<a class="sourceLine" id="cb14-13" data-line-number="13">                                <span class="st">&quot;Evidence in favour&quot;</span>))</a></code></pre></div>
<pre><code># A tibble: 1 x 4
  mean_weight sd_weight   p.value is_mean_equal   
        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;           
1        49.2      1.52 0.0000535 Evidence against</code></pre>
<p>We had checked before that the orange M&amp;M’s were less common. Could
that be related with a change in the mean weight?</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># We can either separate the data:</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">mm3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(Orange <span class="op">&lt;=</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="st">      </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(Weight),</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">                <span class="dt">sd_weight =</span> <span class="kw">sd</span>(Weight), </a>
<a class="sourceLine" id="cb16-6" data-line-number="6">                <span class="dt">p.value =</span> <span class="kw">t.test</span>(Weight, <span class="dt">mu =</span> <span class="fl">47.9</span>)<span class="op">$</span>p.value)</a></code></pre></div>
<pre><code># A tibble: 1 x 3
  mean_weight sd_weight p.value
        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1        49.4      1.66  0.0287</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">mm3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(Orange <span class="op">&gt;</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">      </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(Weight),</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">                <span class="dt">sd_weight =</span> <span class="kw">sd</span>(Weight), </a>
<a class="sourceLine" id="cb18-5" data-line-number="5">                <span class="dt">p.value =</span> <span class="kw">t.test</span>(Weight, <span class="dt">mu =</span> <span class="fl">47.9</span>)<span class="op">$</span>p.value) </a></code></pre></div>
<pre><code># A tibble: 1 x 3
  mean_weight sd_weight p.value
        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1        49.1      1.50 0.00108</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Or create a grouping variable: </span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">mm3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">orange_low =</span> <span class="kw">ifelse</span>(Orange <span class="op">&lt;=</span><span class="st"> </span><span class="dv">4</span>, <span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Normal&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(orange_low) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(Weight),</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">            <span class="dt">sd_weight =</span> <span class="kw">sd</span>(Weight), </a>
<a class="sourceLine" id="cb20-8" data-line-number="8">            <span class="dt">p.value =</span> <span class="kw">t.test</span>(Weight, <span class="dt">mu =</span> <span class="fl">47.9</span>)<span class="op">$</span>p.value)</a></code></pre></div>
<pre><code># A tibble: 2 x 4
  orange_low mean_weight sd_weight p.value
  &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 Low               49.4      1.66 0.0287 
2 Normal            49.1      1.50 0.00108</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># Or use some other heuristic, such as filtering by the 10 lowest </span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co"># orange values</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">mm3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(Orange) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(Weight),</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">            <span class="dt">sd_weight =</span> <span class="kw">sd</span>(Weight), </a>
<a class="sourceLine" id="cb22-9" data-line-number="9">            <span class="dt">p.value =</span> <span class="kw">t.test</span>(Weight, <span class="dt">mu =</span> <span class="fl">47.9</span>)<span class="op">$</span>p.value)</a></code></pre></div>
<pre><code># A tibble: 1 x 3
  mean_weight sd_weight p.value
        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1        49.4      1.57  0.0138</code></pre>
<p>Those are more or less simple operations to find some statistics
about the data. However,
the <code>dplyr</code> has its own website where many more information and
resources can be found: <a href="https://dplyr.tidyverse.org/" class="uri">https://dplyr.tidyverse.org/</a></p>
<p>Besides that, the <code>dplyr</code> functions also have many handy extensions
such as the:</p>
<ul>
<li><code>_all()</code>: performs an operation is all columns</li>
<li><code>_at</code>: performs an operation at some specific columns</li>
<li><code>_if</code> performs an operation <em>if</em> a condition is satisfied</li>
</ul>
</div>
<div id="cleaning" class="section level2">
<h2><span class="header-section-number">4.2</span> Cleaning</h2>
<p>Very frequently, before actually starting our analysis, we first
need to clean our data. This means we need to fix possible errors,
adding or removing information, formatting it, always trying to be
the most thorough possible in order to avoid.
Let us consider now a second dataset from a typical clinical trial
with continuous and characted variables, that will require a bit more of
cleaning. A few other packages will be used in combination with the
<code>dplyr</code>, especially the <code>stringr</code> and <code>forcats</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co"># Just reading the data </span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">pt &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/Patients.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="co"># Showing the types and first rows of the data.frame</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5">pt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>Observations: 31
Variables: 8
$ PATNO  &lt;fct&gt; 1, 2, 3, 4, XX5, 6, 7, , 8, 9, 10, 11, 12, 13, 14, 2, 3, …
$ GENDER &lt;fct&gt; M, F, X, F, M, , M, M, F, M, f, M, M, 2, M, F, M, F, F, M…
$ VISIT  &lt;fct&gt; 11/11/1998, 11/13/1998, 10/21/1998, 01/01/1999, 05/07/199…
$ HR     &lt;int&gt; 88, 84, 68, 101, 68, 72, 88, 90, 210, 86, NA, 68, 60, 74,…
$ SBP    &lt;int&gt; 140, 120, 190, 200, 120, 102, 148, 190, NA, 240, 40, 300,…
$ DBP    &lt;int&gt; 80, 78, 100, 120, 80, 68, 102, 100, NA, 180, 120, 20, 74,…
$ DX     &lt;fct&gt; 1, X, 3, 5, 1, 6, , , 7, 4, 1, 4, , 1, , X, , 3, 2, , 1, …
$ AE     &lt;fct&gt; 0, 0, 1, A, 0, 1, 0, 0, 0, 1, 0, 1, 0, , 1, 0, 0, 1, 0, 0…</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># Fixing the names of the columns </span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="kw">names</span>(pt) &lt;-<span class="st"> </span><span class="kw">str_to_lower</span>(<span class="kw">names</span>(pt))</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co"># Finding frequency tables per gender </span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">pt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(gender)</a></code></pre></div>
<pre><code># A tibble: 6 x 2
  gender     n
  &lt;fct&gt;  &lt;int&gt;
1 &quot;&quot;         1
2 2          1
3 f          2
4 F         12
5 M         14
6 X          1</code></pre>
<p>The first problem was found: the gender column is not standardized,
as we have both lower and upper cases and an empty level. This is
easily fixable with the help of functions from the <code>stringr</code> package:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">pt &lt;-<span class="st"> </span>pt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="st">  </span><span class="co"># Transform lower cases to upper cases in gender</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gender =</span> <span class="kw">str_to_upper</span>(gender)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="st">  </span><span class="co"># Replacing the empty or strange information for something more useful</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gender =</span> <span class="kw">ifelse</span>(gender <span class="op">%in%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="st">                           </span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;X&quot;</span>), <span class="st">&quot;Not Available&quot;</span>, gender))</a>
<a class="sourceLine" id="cb28-7" data-line-number="7"></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="co"># View the frequency table again</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9">pt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="st">  </span><span class="kw">count</span>(gender)</a></code></pre></div>
<pre><code># A tibble: 3 x 2
  gender            n
  &lt;chr&gt;         &lt;int&gt;
1 F                14
2 M                14
3 Not Available     3</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># Now it makes more sense!</span></a></code></pre></div>
<p>However, we still can spot a few problems. For instance, the variable
names <code>visit</code> was read as factor, while we now that it should be
interpreted as a date. We can use the <code>lubridate</code> package to fix
in situations like this.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># Transforming the variable into a date type</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2">pt &lt;-<span class="st"> </span>pt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">visit =</span> <span class="kw">as.Date</span>(visit, <span class="st">&quot;%m/%d/%Y&quot;</span>), </a>
<a class="sourceLine" id="cb31-4" data-line-number="4">         <span class="dt">day =</span> lubridate<span class="op">::</span><span class="kw">day</span>(visit), </a>
<a class="sourceLine" id="cb31-5" data-line-number="5">         <span class="dt">month =</span> lubridate<span class="op">::</span><span class="kw">month</span>(visit), </a>
<a class="sourceLine" id="cb31-6" data-line-number="6">         <span class="dt">month_year =</span> zoo<span class="op">::</span><span class="kw">as.yearmon</span>(visit))</a>
<a class="sourceLine" id="cb31-7" data-line-number="7"></a>
<a class="sourceLine" id="cb31-8" data-line-number="8"><span class="co"># Check that it is transformed</span></a>
<a class="sourceLine" id="cb31-9" data-line-number="9"><span class="kw">class</span>(pt<span class="op">$</span>visit)</a></code></pre></div>
<pre><code>[1] &quot;Date&quot;</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co"># How many observations we have each month? </span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2">pt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(month)</a></code></pre></div>
<pre><code># A tibble: 13 x 2
   month     n
   &lt;dbl&gt; &lt;int&gt;
 1     1     2
 2     2     1
 3     3     1
 4     4     1
 5     5     2
 6     6     2
 7     7     1
 8     8     2
 9     9     1
10    10     4
11    11     6
12    12     1
13    NA     7</code></pre>
<p>–&gt; Exercises: <a href="https://teachingr.com/content/the-5-verbs-of-dplyr/the-5-verbs-of-dplyr-exercise.html" class="uri">https://teachingr.com/content/the-5-verbs-of-dplyr/the-5-verbs-of-dplyr-exercise.html</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reading-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plotting-data-with-ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
